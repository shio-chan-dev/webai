# 安全与风控设计

本文档描述平台在账号安全、游戏币安全和 AI 服务滥用防护等方面的基本策略。MVP 阶段先实现基础能力，后续逐步增强。

---

## 1. 账号与认证安全

- 密码存储：
  - 仅存储密码哈希（如 bcrypt / Argon2）
  - 严禁明文密码
- 登录保护：
  - 登录错误次数过多时，对 IP / 账号进行短暂锁定
  - 可选支持多因素认证（后续）
- Token 管理：
  - 使用 JWT 或随机 Token，设置合理过期时间
  - 支持服务端黑名单 / 撤销机制（重要操作后可强制重新登录）

---

## 2. 游戏币与交易安全

- 强一致性：
  - 余额更新与交易流水写入应在同一事务中完成
  - 避免「扣费成功但未记录交易」或「有交易记录但余额没变」
- 幂等性：
  - 对可能重试的接口（如任务奖励、充值回调）设计幂等机制
  - 可使用业务唯一键（如 `idempotency_key`）防止重复发币
- 管理员操作审计：
  - 管理后台发币 / 调整余额必须记录操作者、时间与原因
  - 重要操作可要求二次确认

---

## 3. AI 调用防刷与滥用

- 请求限频：
  - 按用户 ID / IP / 设备 ID 设定调用速率限制
  - 对异常高频行为触发警报或临时封禁
- 内容风控：
  - 可对部分敏感内容进行限制或过滤（视业务需求与合规要求而定）
- 监控与告警：
  - 记录 AI 调用失败率、延迟、使用量
  - 超出阈值时触发告警（服务异常 / 滥用行为）

---

## 4. 托管钱包与链上安全（预研）

虽然 MVP 以链下为主，但为后续引入链上层预留安全设计思路：

- 私钥管理：
  - 使用 HSM / KMS 等安全设施管理主私钥
  - 按用户生成钱包时，私钥加密存储并最小化暴露范围
- 热 / 冷钱包：
  - 大额资金存放在冷钱包，仅在人工审核后进行大额转移
  - 热钱包只保留运营所需的小额资金
- 代付与 AA：
  - 严格限制代付策略（每用户每日代付额度）
  - 对异常高额 / 高频交易进行拦截和人工复核

---

## 5. 反作弊与薅羊毛防控

- 注册赠币：
  - 限制同一设备 / IP / 设备指纹短时间内注册数量
  - 对疑似机器注册的模式进行识别与封禁
- 任务与奖励：
  - 防止通过脚本自动完成任务
  - 对异常高频完成任务的账户进行标记与人工审核
- 多账号行为关联：
  - 通过 IP、设备、浏览器指纹等维度建立简单关联分析（注意隐私与合规）

---

## 6. 数据与隐私保护

- 日志与数据收集：
  - 遵守所在区域的隐私保护法规（如 GDPR 等）
  - 限制收集的用户敏感信息，不做不必要的长期存储
- AI 请求内容：
  - 对可能包含敏感信息的内容进行脱敏或匿名化存储
  - 提供用户数据导出与删除机制（后续）

---

## 7. 部署与运维安全

- 环境隔离：
  - 开发 / 测试 / 生产环境严格隔离
- 访问控制：
  - 对数据库、日志系统、监控面板等限制访问权限
- 配置与密钥：
  - 使用环境变量或专用配置管理系统存储密钥
  - 禁止将密钥写入代码仓库

---

## 8. MVP 阶段最小安全基线

在 MVP 阶段，至少应落实：

- 密码哈希 + 基本登录限速
- 游戏币变更事务性保证（余额 + 流水一致）
- AI 调用基础限频（避免明显的批量刷接口）
- 管理员发币操作记录审计

后续随着用户量与资金规模增长，再逐步强化更复杂的风控策略。

