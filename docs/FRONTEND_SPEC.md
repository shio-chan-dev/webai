# 前端应用设计规范

本文档描述前端应用的页面结构、路由设计和与后端的交互方式。技术栈推荐 React / Next.js + TailwindCSS，但也可用其他框架实现。

---

## 1. 页面与路由结构

建议的主要路由：

- `/login`：登录 / 注册页（可合并）
- `/app/chat`：AI 对话页面（核心使用场景）
- `/wallet`：游戏币钱包页面
- `/tasks`：任务 / 活动页面
- `/admin`：后台入口（可分离为单独子应用）

如使用 Next.js，可以采用：

- `app/login/page.tsx`
- `app/app/chat/page.tsx`
- `app/wallet/page.tsx`
- `app/tasks/page.tsx`
- `app/admin/...`

---

## 2. 公共布局与导航

### 2.1 全局布局

- 顶部导航栏：
  - 左侧：Logo / 项目名称
  - 中间：导航链接（AI 对话、钱包、任务）
  - 右侧：当前用户信息（昵称、头像）与余额快照
- 主内容区域：
  - 显示当前路由对应的页面内容

### 2.2 登录态管理

- 未登录用户访问受保护页面（如 `/app/chat`、`/wallet`）时应被重定向到 `/login`
- 登录成功后，前端保存 Token（LocalStorage / Cookie）并更新全局用户状态

---

## 3. 页面设计细节

### 3.1 登录 / 注册页（`/login`）

功能：

- 支持邮箱 / 手机号 + 密码登录
- 支持注册新用户

UI 建议：

- 左侧展示产品卖点文案（如「用游戏币体验 AI」）
- 右侧为登录 / 注册切换 Tab

交互：

- 登录成功：
  - 拉取当前用户信息（`GET /api/auth/me`）
  - 跳转至 `/app/chat`
- 注册成功：
  - 显示「已获得初始赠币」提示
  - 同样跳转至 `/app/chat`

### 3.2 AI 对话页（`/app/chat`）

功能：

- 显示对话消息列表
- 支持用户输入问题并发送
- 显示 AI 回复
- 在适当位置展示「每次调用消耗多少游戏币」提示

交互流程：

1. 用户输入内容，点击发送
2. 前端调用 `POST /api/ai/chat`
3. 显示加载状态（如「AI 正在思考...」）
4. 收到响应后：
   - 将用户消息与 AI 回复追加到对话列表
   - 更新全局余额（从响应的 `balance` 或重新拉取 `GET /api/wallet`）
5. 余额不足时：
   - 弹出提示：「余额不足，请前往任务页获取游戏币」
   - 提供跳转到 `/tasks` 的按钮

### 3.3 钱包页（`/wallet`）

功能：

- 展示当前余额
- 展示最近一段时间的交易流水

接口：

- `GET /api/wallet`
- `GET /api/wallet/transactions`

UI 建议：

- 顶部大号展示余额（例如金币图标 + 数字）
- 下方按时间倒序展示交易列表：
  - 图标：收入 / 支出不同颜色
  - 文案：`reason` + `type` 标签
  - 时间：格式化显示（例如「5 分钟前」）

### 3.4 任务页（`/tasks`）

功能：

- 展示任务列表
- 显示每个任务的奖励金额与完成状态
- 已完成任务可以点击领取奖励

接口：

- `GET /api/tasks`
- `POST /api/tasks/{task_id}/claim`

UI 建议：

- 每个任务卡片包含：
  - 名称 + 描述
  - 奖励游戏币数量
  - 状态按钮：
    - `去完成`（跳转相应页面，如 AI 对话）
    - `领取奖励`
    - `已领取`

### 3.5 管理后台入口（`/admin`）

MVP 阶段可先只做基础功能：

- 管理员登录表单
- 简单的数据表格页面（用户列表 / 交易列表）
- 手动发放游戏币的表单

也可以选择将后台完全拆分为一个独立的前端项目。

---

## 4. 前端状态管理

### 4.1 全局状态

建议维护以下全局状态：

- 当前用户信息 `currentUser`
- 当前余额 `balance`
- 登录状态 `isAuthenticated`

可选方案：

- React Context + 自定义 Hook
- Redux / Zustand 等状态管理库

### 4.2 接口封装

- 使用 `axios` / `fetch` 封装统一的 API 客户端：
  - 自动附带 `Authorization` 头
  - 统一处理错误码（如 Token 失效时跳转登录）
- 可统一定义响应格式类型，便于在组件中使用 TS 类型提示

---

## 5. 用户体验与细节

- 加载状态：
  - API 请求期间按钮禁用 / 显示 Loading
- 错误提示：
  - 余额不足等业务错误以明显的提示组件展示
  - 技术错误可用 Toast 提示
- 移动端适配：
  - MVP 阶段建议至少保证移动端可以使用
- 国际化：
  - 初期可只支持中文，后续可引入 i18n

---

## 6. 安全与风控配合

前端需要配合后端的安全策略：

- 不在前端保存敏感信息（如密码明文）
- Token 存储方式需权衡 XSS / CSRF 风险
- 对明显异常行为可在前端做简单限制（如客户端限频），但以服务端为准

更多安全细节见 `docs/SECURITY_RISK_CONTROL.md`。

